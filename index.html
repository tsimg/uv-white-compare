<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image Comparison (Zoom + Pan + Caption)</title>
  <style>
    :root { --pos: 50%; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: #111;
      color: #eee;
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 18px;
      box-sizing: border-box;
    }

    .wrap { width: min(1400px, 100%); }

    /* Bigger viewer */
    .viewer {
      position: relative;
      width: 100%;
      height: 85vh;
      max-height: 900px;
      background: #222;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,.4);
      user-select: none;
      touch-action: none;
    }

    /* Stage that gets transformed (pan/zoom) */
    .stage {
      position: absolute;
      inset: 0;
      transform: translate(var(--tx, 0px), var(--ty, 0px)) scale(var(--s, 1));
      transform-origin: 0 0;
      will-change: transform;
    }

    .stage img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;            /* cover */
      background: #000;
      pointer-events: none;
    }

    /* Top image is clipped to reveal the bottom underneath */
    .top {
      clip-path: inset(0 calc(100% - var(--pos)) 0 0);
    }

    /* Handle line + grabber */
    .handle {
      position: absolute;
      top: 0;
      bottom: 0;
      left: var(--pos);
      width: 44px;
      transform: translateX(-50%);
      cursor: ew-resize;
      z-index: 5;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .handle .line {
      position: absolute;
      top: 0; bottom: 0;
      width: 2px;
      background: rgba(255,255,255,.85);
      box-shadow: 0 0 0 1px rgba(0,0,0,.35);
    }
    .handle .knob {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: rgba(255,255,255,.92);
      box-shadow: 0 6px 18px rgba(0,0,0,.35);
      border: 1px solid rgba(0,0,0,.2);
    }

    /* Overlay labels (inside image) */
    .labels {
      position: absolute;
      inset: 0;
      z-index: 6;
      pointer-events: none;
    }

    .labelBox {
      position: absolute;
      top: 14px;
      padding: 8px 10px;
      border-radius: 12px;
      background: rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      font-size: 14px;
      line-height: 1.15;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    .labelLeft  { left: 14px; }
    .labelRight { right: 14px; }

    .chip {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      display: inline-block;
      box-shadow: 0 0 0 1px rgba(255,255,255,.25) inset;
    }

    /* Figure-caption style under the viewer */
    .caption {
      margin-top: 10px;
      margin-bottom: 12px;
      padding: 0 2px;              /* more “caption”, less “panel” */
      font-size: 13px;
      line-height: 1.4;
      color: rgba(255,255,255,.82);
    }
    .caption strong {
      color: rgba(255,255,255,.92);
      font-weight: 600;
    }

    .controls {
      display: grid;
      gap: 10px;
      margin-top: 0;
    }
    .row {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    input[type="range"] { width: 100%; }

    button {
      background: #1e1e1e;
      color: #eee;
      border: 1px solid rgba(255,255,255,.15);
      border-radius: 10px;
      padding: 8px 12px;
      cursor: pointer;
    }
    button:hover { border-color: rgba(255,255,255,.35); }

    .hint { font-size: 13px; opacity: .8; }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="viewer" id="viewer" aria-label="Image comparison viewer">
      <div class="stage" id="stage">
        <!-- Bottom image -->
        <img src="imageA.jpg" alt="UV illumination (bottom)">
        <!-- Top image (revealed by slider) -->
        <img src="imageB.jpg" alt="White light illumination (top)" class="top" id="topImg">
      </div>

      <div class="handle" id="handle" aria-label="Drag to compare">
        <div class="line"></div>
        <div class="knob"></div>
      </div>

      <div class="labels" aria-hidden="true">
        <div class="labelBox labelLeft">
          <span class="chip" style="background:#7c5cff;"></span>
          UV illumination
        </div>

        <div class="labelBox labelRight">
          <span class="chip" style="background:#ddd;"></span>
          White light illumination
        </div>
      </div>
    </div>

    <!-- Caption under the viewer -->
    <div class="caption" role="note">
      <strong>Figure 1.</strong>
      A grain sample containing 2% wt spodumene under UV illumination (left) and white light (right).
      Drag the slider to compare; use scroll to zoom and drag to pan.
    </div>

    <div class="controls">
      <div class="row">
        <div class="hint">
          Drag the handle to compare. Scroll to zoom. Drag (not on handle) to pan when zoomed.
        </div>
        <div class="hint"><span id="pct">50</span>%</div>
      </div>

      <input id="range" type="range" min="0" max="100" value="50" />

      <div class="row">
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button id="zin" type="button">Zoom +</button>
          <button id="zout" type="button">Zoom −</button>
          <button id="zreset" type="button">Reset</button>
        </div>
        <div class="hint">Zoom: <span id="zread">1.00×</span></div>
      </div>
    </div>
  </div>

  <script>
    const viewer = document.getElementById('viewer');
    const handle = document.getElementById('handle');
    const range  = document.getElementById('range');
    const pctEl  = document.getElementById('pct');

    const zin    = document.getElementById('zin');
    const zout   = document.getElementById('zout');
    const zreset = document.getElementById('zreset');
    const zread  = document.getElementById('zread');

    // --- comparison position ---
    function setPos(percent) {
      const p = Math.min(100, Math.max(0, percent));
      document.documentElement.style.setProperty('--pos', p + '%');
      range.value = p;
      pctEl.textContent = Math.round(p);
    }
    range.addEventListener('input', (e) => setPos(Number(e.target.value)));

    function percentFromClientX(clientX) {
      const r = viewer.getBoundingClientRect();
      return ((clientX - r.left) / r.width) * 100;
    }

    // --- pan/zoom state ---
    let s = 1.0;        // scale
    let tx = 0, ty = 0; // translation in px

    function applyTransform() {
      document.documentElement.style.setProperty('--s',  s);
      document.documentElement.style.setProperty('--tx', tx + 'px');
      document.documentElement.style.setProperty('--ty', ty + 'px');
      zread.textContent = s.toFixed(2) + '×';
    }

    // Allows panning across the full extra extent when zoomed
    function clampPan() {
      const r = viewer.getBoundingClientRect();
      const maxX = r.width  * (s - 1);
      const maxY = r.height * (s - 1);

      if (s <= 1.001) { tx = 0; ty = 0; return; }

      // Keep within [ -max, 0 ] so you can pan across the enlarged content
      tx = Math.max(-maxX, Math.min(0, tx));
      ty = Math.max(-maxY, Math.min(0, ty));
    }

    function zoomAt(clientX, clientY, factor) {
      const r = viewer.getBoundingClientRect();
      const px = clientX - r.left;
      const py = clientY - r.top;

      const sx = (px - tx) / s;
      const sy = (py - ty) / s;

      const newS = Math.min(8, Math.max(1, s * factor));
      if (Math.abs(newS - s) < 1e-6) return;

      tx = px - sx * newS;
      ty = py - sy * newS;
      s = newS;

      clampPan();
      applyTransform();
    }

    // Buttons
    zin.addEventListener('click', () => {
      const r = viewer.getBoundingClientRect();
      zoomAt(r.left + r.width/2, r.top + r.height/2, 1.25);
    });
    zout.addEventListener('click', () => {
      const r = viewer.getBoundingClientRect();
      zoomAt(r.left + r.width/2, r.top + r.height/2, 1/1.25);
    });
    zreset.addEventListener('click', () => {
      s = 1; tx = 0; ty = 0;
      applyTransform();
    });

    // Wheel zoom
    viewer.addEventListener('wheel', (e) => {
      e.preventDefault();
      const factor = e.deltaY < 0 ? 1.12 : 1/1.12;
      zoomAt(e.clientX, e.clientY, factor);
    }, { passive: false });

    // --- Interaction routing: handle drag vs pan drag ---
    let draggingHandle = false;
    let draggingPan = false;
    let panStartX = 0, panStartY = 0;
    let panOrigTX = 0, panOrigTY = 0;

    function onPointerDown(e) {
      const isHandle = e.target === handle || handle.contains(e.target);

      if (isHandle) {
        draggingHandle = true;
        setPos(percentFromClientX(e.clientX));
      } else {
        if (s > 1.001) {
          draggingPan = true;
          panStartX = e.clientX;
          panStartY = e.clientY;
          panOrigTX = tx;
          panOrigTY = ty;
        } else {
          setPos(percentFromClientX(e.clientX));
        }
      }

      viewer.setPointerCapture?.(e.pointerId);
    }

    function onPointerMove(e) {
      if (draggingHandle) {
        setPos(percentFromClientX(e.clientX));
      } else if (draggingPan) {
        tx = panOrigTX + (e.clientX - panStartX);
        ty = panOrigTY + (e.clientY - panStartY);
        clampPan();
        applyTransform();
      }
    }

    function onPointerUp() {
      draggingHandle = false;
      draggingPan = false;
    }

    viewer.addEventListener('pointerdown', onPointerDown);
    viewer.addEventListener('pointermove', onPointerMove);
    viewer.addEventListener('pointerup', onPointerUp);
    viewer.addEventListener('pointercancel', onPointerUp);

    // init
    setPos(50);
    applyTransform();
  </script>
</body>
</html>
